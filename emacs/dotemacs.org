#+title: Dotemacs
#+PROPERTY: header-args:emacs-lisp :tangle ~/.emacs :mkdirp yes

* Dotemacs
** Package setup

This bootstraps [[https://github.com/radian-software/straight.el][straight.el]] and [[https://github.com/jwiegley/use-package][use-package]] to install packages either from a package repository or from Github. I got the setup from [[https://jeffkreeftmeijer.com/emacs-straight-use-package/][here]], mostly.

#+begin_src emacs-lisp
  (setq package-enable-at-startup nil)
  (defvar bootstrap-version)
  (let ((bootstrap-file (expand-file-name "straight/repos/straight.el/bootstrap.el"
					  user-emacs-directory))
	(bootstrap-version 6))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer (url-retrieve-synchronously
			    "https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el" 'silent 'inhibit-cookies)
  (goto-char (point-max))
  (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

  (unless (package-installed-p 'use-package)
  (package-install 'use-package))

  (require 'use-package)
  (straight-use-package 'use-package)
  (use-package
      straight
      :custom (straight-use-package-by-default t))
#+end_src

** Literate config setup

#+begin_src emacs-lisp
  (org-babel-do-load-languages 'org-babel-load-languages '((emacs-lisp . t)
							   (python . t)))

  (push '("conf-unix" . conf-unix) org-src-lang-modes)

  ;; Automatically tangle our Emacs.org config file when we save it
  (defun efs/org-babel-tangle-config ()
    (when (string-equal (buffer-file-name)
			(expand-file-name "~/Code/dotfiles/emacs/dotemacs.org"))
      ;; Dynamic scoping to the rescue
      (let ((org-confirm-babel-evaluate nil))
	(org-babel-tangle))))

  (add-hook 'org-mode-hook (lambda ()
			     (add-hook 'after-save-hook #'efs/org-babel-tangle-config)))
  (add-hook 'after-save-hook (lambda ()
			       (load-file (expand-file-name "~/.emacs"))))
#+end_src

** Git config

#+begin_src emacs-lisp
  (use-package magit)
#+end_src

** Code formatting

*** Elisp

#+begin_src emacs-lisp
  (use-package elisp-format)
#+end_src

** Web mode

#+begin_src emacs-lisp
  (use-package web-mode :ensure t)
  (add-to-list 'auto-mode-alist '("\\.njk\\'" . web-mode))
#+end_src

** Evil ðŸ¤˜

#+begin_src emacs-lisp
  (setq evil-want-keybinding nil)
  (use-package
    evil
    :config (evil-mode 1))
  (use-package
    evil-commentary
    :ensure t)
  (evil-commentary-mode 1)
  (use-package
    evil-surround
    :config (global-evil-surround-mode 1))
  (use-package
    simpleclip)
  (simpleclip-mode 1)

  ;; Make cmd-v work to paste from system clipboard
  ;; https://github.com/rolandwalker/simpleclip/issues/1
  (setq mac-option-modifier 'meta)
  (setq mac-command-modifier 'super)
  (setq mac-pass-command-to-system nil)
  (use-package
    evil-collection)
#+end_src

** UI & Theme

TODO: Get ligatures working

#+begin_src emacs-lisp
  (set-frame-font "JuliaMono 14" nil t)

  (use-package
    doom-themes
    :config
    ;; Global settings (defaults)
    (setq doom-themes-enable-bold t ; if nil, bold is universally disabled
	  doom-themes-enable-italic t) ; if nil, italics is universally disabled
    (load-theme 'doom-nord t)

    ;; Enable flashing mode-line on errors
    (doom-themes-visual-bell-config)
    ;; Corrects (and improves) org-mode's native fontification.
    (doom-themes-org-config))

  (use-package
    doom-modeline
    :init (doom-modeline-mode 1))

  (use-package all-the-icons)
#+end_src

*** Org Mode Appearance

Org mode needs some extra attention to really shine. This adds fancy bullets.

#+begin_src emacs-lisp
  (setq org-hide-emphasis-markers t)

  (use-package
    org-bullets
    :config (add-hook 'org-mode-hook (lambda ()
				       (org-bullets-mode 1))))

  (add-hook 'org-mode-hook 'visual-line-mode)

#+end_src

Also set custom faces and line heights for different levels of indentation. These settings are from [[https://zzamboni.org/post/beautifying-org-mode-in-emacs/][here]] but will probably change.

#+begin_src emacs-lisp
  (let* ((variable-tuple (cond ((x-list-fonts "ETBembo")
				'(:font "ETBembo"))
			       ((x-list-fonts "Source Sans Pro")
				'(:font "Source Sans Pro"))
			       ((x-list-fonts "Lucida Grande")
				'(:font "Lucida Grande"))
			       ((x-list-fonts "Verdana")
				'(:font "Verdana"))
			       ((x-family-fonts "Sans Serif")
				'(:family "Sans Serif"))
			       (nil
				(warn
				 "Cannot find a Sans Serif Font.  Install Source Sans Pro."))))

	 (headline
	  `(:inherit default
		     :weight bold
		     )))
    (custom-theme-set-faces 'user `(org-level-8 ((t (,@headline ,@variable-tuple))))
			    `(org-level-7 ((t (,@headline ,@variable-tuple))))
			    `(org-level-6 ((t (,@headline ,@variable-tuple))))
			    `(org-level-5 ((t (,@headline ,@variable-tuple))))
			    `(org-level-4 ((t (,@headline ,@variable-tuple
							  :height 1.1))))
			    `(org-level-3 ((t (,@headline ,@variable-tuple
							  :height 1.25))))
			    `(org-level-2 ((t (,@headline ,@variable-tuple
							  :height 1.5))))
			    `(org-level-1 ((t (,@headline ,@variable-tuple
							  :height 1.75))))
			    `(org-document-title ((t (,@headline ,@variable-tuple
								 :height 2.0
								 :underline nil))))))
#+end_src
